# GlobalHydro
Global high-resolution streamflow modeling at 2.94 million river reaches extracted from ~90 m DEM

Reference: Lin, P., M. Pan, H.E. Beck, Y. Yang, D. Yamazaki, R. Frasson, C.H. David, M. Durand, T. Pavelsky, G. Allen, C. Gleason, E.F. Wood (2019): Global reconstruction of naturalized river flows at 2.94 million reaches. Water Resources Research. [Eos Editor's Highlight: https://eos.org/editor-highlights/reconstructing-natural-streamflow-at-unprecedented-resolution]

1. Set up global routing model configurations and prepare inputs for the RAPID model:
(1) make_intersect.py #intersect unit catchment with LSM grids
(2) make_weight.py #generate weight table
(3) fast_connectivity.py #extract topology (river connectivity) using flowline shapefiles

2. Bias correction against nine runoff charactersistics maps derived from machine learning
(1) generate_pixels.py #extract all lat/lon info for grid cells that need BC (in this case ~0.24 million VIC grid cells)
(2) main_BC.py #main program for bias correction (see Lin et al. 2019; WRR submitted) for more details
(3) control.py #control jobs/cores to divide the entire domain (in this example, 40 jobs 10 cores are used for faster processing)

3. Generate property tables for shapefile
(1) calc_order.py #extract Strahler stream order for flowlines based on calculate connectivity table (see #1)
(2) calc_area.py #calculate the unit catchment area in km2 using AEA (Albert Equal Area) projection

Update: 2019-09-26
Added make_m3.py: This script takes gridded runoff time series data (runoff.nc) and the weight table (weight_table.csv) that establishes mapping between rectangular LSM grids to any vector flowline datasets (as generated by make_intersect.py and make_weight.py), which produces m3_riv.nc formatted as the Vlat file required by the RAPID river routing model (lateral inflow to the vector flowlines at every time step).

More info: contact Peirong Lin (peirongl@princeton.edu) for questions
March 2019
